"use strict";(()=>{var e={};e.id=282,e.ids=[282],e.modules={9344:e=>{e.exports=require("jsonwebtoken")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,i){return i in t?t[i]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,i)):"function"==typeof t&&"default"===i?t:void 0}}})},9241:(e,t,i)=>{i.r(t),i.d(t,{config:()=>c,default:()=>l,routeModule:()=>E});var n={};i.r(n),i.d(n,{default:()=>u});var r=i(1802),s=i(7153),a=i(6249),o=i(6397),d=i(2167);async function u(e,t){let i;if("POST"!==e.method)return t.status(405).json({message:"Method not allowed"});let n=(0,d.H)(e,t);if(!n)return t.status(401).json({message:"Not authenticated"});let{card_id:r}=e.body,s="";try{i=await (0,o.B)();let e=`
            SELECT liked FROM Likes WHERE user_id = ? AND card_id = ?;
        `,[a]=await i.query(e,[n,r]);if(0===a.length){let e=`
                INSERT INTO Likes (user_id, card_id, liked) VALUES (?, ?, TRUE);
            `;await i.query(e,[n,r]),s="Liked"}else{let e=a[0].liked,t=`
                UPDATE Likes SET liked = NOT liked WHERE user_id = ? AND card_id = ?;
            `;await i.query(t,[n,r]),s=e?"Unliked":"Liked"}let d=`
            UPDATE Cards SET like_count = (
                SELECT COUNT(*) FROM Likes WHERE card_id = ? AND liked = TRUE
            ) WHERE card_id = ?;
        `;await i.query(d,[r,r]);let[u]=await i.query("SELECT like_count FROM Cards WHERE card_id = ?",[r]),l=u[0]?.like_count||0;t.status(200).json({message:s,likeCount:l})}catch(e){console.error("Failed to process like",e),t.status(500).json({message:"Failed to process like"})}finally{i&&i.release()}}let l=(0,a.l)(n,"default"),c=(0,a.l)(n,"config"),E=new r.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/comments/like",pathname:"/api/comments/like",bundlePath:"",filename:""},userland:n})},6397:(e,t,i)=>{i.d(t,{B:()=>s});let n=require("mysql2/promise"),r=i.n(n)().createPool({host:process.env.DB_HOST,user:process.env.DB_USER,password:process.env.DB_PASSWORD,database:process.env.DB_NAME,waitForConnections:!0,connectionLimit:10,queueLimit:0});async function s(){return await r.getConnection()}},2167:(e,t,i)=>{i.d(t,{H:()=>s});var n=i(9344),r=i.n(n);function s(e,t){let{token:i}=e.cookies;if(!i)return t.status(401).json({message:"Not authenticated"});try{return r().verify(i,process.env.JWT_SECRET).id}catch(e){return t.status(401).json({message:"Invalid token"})}}},7153:(e,t)=>{var i;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return i}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(i||(i={}))},1802:(e,t,i)=>{e.exports=i(145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var i=t(t.s=9241);module.exports=i})();