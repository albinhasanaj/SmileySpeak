"use strict";(()=>{var e={};e.id=265,e.ids=[265],e.modules={7096:e=>{e.exports=require("bcrypt")},9344:e=>{e.exports=require("jsonwebtoken")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,n){return n in t?t[n]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,n)):"function"==typeof t&&"default"===n?t:void 0}}})},594:(e,t,n)=>{n.r(t),n.d(t,{config:()=>f,default:()=>p,routeModule:()=>P});var s={};n.r(s),n.d(s,{default:()=>c});var r=n(1802),a=n(7153),i=n(6249),o=n(7096),u=n.n(o),l=n(6397),d=n(9970);async function c(e,t){if("POST"==e.method){let n;try{let n=await (0,l.B)(),{username:s,password:r}=e.body;if(!s||!r)return t.status(400).json({message:"Please fill in all fields"});let[a]=await n.execute("SELECT * FROM users WHERE username = ?",[s]);if(0===a.length)return t.status(400).json({message:"Invalid username or password"});let i=a[0];if(!await u().compare(r,i.password))return t.status(400).json({message:"Invalid username or password"});let o=(0,d.R)(i.id);t.setHeader("Set-Cookie",`token=${o}; Path=/; HttpOnly; SameSite=Lax; Max-Age=2592000;`),t.status(200).json({message:"Logged in successfully"})}catch(e){t.status(500).json({message:e.message})}finally{n&&n.release()}}}let p=(0,i.l)(s,"default"),f=(0,i.l)(s,"config"),P=new r.PagesAPIRouteModule({definition:{kind:a.x.PAGES_API,page:"/api/auth/login",pathname:"/api/auth/login",bundlePath:"",filename:""},userland:s})},6397:(e,t,n)=>{n.d(t,{B:()=>a});let s=require("mysql2/promise"),r=n.n(s)().createPool({host:process.env.DB_HOST,user:process.env.DB_USER,password:process.env.DB_PASSWORD,database:process.env.DB_NAME,waitForConnections:!0,connectionLimit:10,queueLimit:0});async function a(){return await r.getConnection()}},9970:(e,t,n)=>{n.d(t,{R:()=>a});var s=n(9344),r=n.n(s);function a(e){return r().sign({id:e},process.env.JWT_SECRET,{expiresIn:"30d"})}},7153:(e,t)=>{var n;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return n}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(n||(n={}))},1802:(e,t,n)=>{e.exports=n(145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var n=t(t.s=594);module.exports=n})();